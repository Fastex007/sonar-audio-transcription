# ü§ñ ML –ú–æ–¥–µ–ª–∏ - –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

## üìä –ü—Ä–æ—Å—Ç–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞?

–ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –∞—É–¥–∏–æ–∑–∞–ø–∏—Å—å —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –≤ —Ç–µ–∫—Å—Ç —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ —Å–ø–∏–∫–µ—Ä–∞–º:

```
üéôÔ∏è –ê—É–¥–∏–æ —Ñ–∞–π–ª
    ‚Üì
üé§ Whisper (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏)
    ‚Üì
üìù –¢–µ–∫—Å—Ç: "–ü—Ä–∏–≤–µ—Ç –∫–∞–∫ –¥–µ–ª–∞ –æ—Ç–ª–∏—á–Ω–æ —Å–ø–∞—Å–∏–±–æ –∞ —É —Ç–µ–±—è"
    ‚Üì
üë• Pyannote (–¥–∏–∞—Ä–∏–∑–∞—Ü–∏—è - –∫—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç)
    ‚Üì
üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:
    üë® SPEAKER_00: "–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?"
    üë© SPEAKER_01: "–û—Ç–ª–∏—á–Ω–æ, —Å–ø–∞—Å–∏–±–æ!"
    üë® SPEAKER_00: "–ê —É —Ç–µ–±—è?"
```

---

## üîç –ü–æ–¥—Ä–æ–±–Ω–æ –æ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ

### 1Ô∏è‚É£ Whisper (Speech-to-Text)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –∑–≤—É–∫ –≤ —Ç–µ–∫—Å—Ç

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –°–ª—É—à–∞–µ—Ç –∞—É–¥–∏–æ —Ñ–∞–π–ª
- –ù–∞—Ö–æ–¥–∏—Ç —Å–ª–æ–≤–∞ –∏ —Ñ—Ä–∞–∑—ã
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ (–∫–æ–≥–¥–∞ –Ω–∞—á–∞–ª–æ—Å—å –∏ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å —Å–ª–æ–≤–æ)
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —è–∑—ã–∫ (—Ä—É—Å—Å–∫–∏–π, –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ç.–¥.)

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "text": "–ü—Ä–∏–≤–µ—Ç –∫–∞–∫ –¥–µ–ª–∞",
  "segments": [
    {"start": 0.0, "end": 0.5, "text": "–ü—Ä–∏–≤–µ—Ç"},
    {"start": 0.6, "end": 1.2, "text": "–∫–∞–∫"},
    {"start": 1.3, "end": 1.8, "text": "–¥–µ–ª–∞"}
  ],
  "language": "ru"
}
```

### 2Ô∏è‚É£ Pyannote (Speaker Diarization)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ö–¢–û –≥–æ–≤–æ—Ä–∏—Ç –≤ –∫–∞–∂–¥—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≥–æ–ª–æ—Å–∞ (—Ç–æ–Ω, —Ç–µ–º–±—Ä, –≤—ã—Å–æ—Ç—É)
- –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø–æ—Ö–æ–∂–∏–µ –≥–æ–ª–æ—Å–∞
- –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –∫–∞–∂–¥–æ–º—É —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è (SPEAKER_00, SPEAKER_01...)
- –ù–µ –∑–Ω–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ - –ø—Ä–æ—Å—Ç–æ –Ω—É–º–µ—Ä—É–µ—Ç –≥–æ–ª–æ—Å–∞

**–ü—Ä–∏–º–µ—Ä:**
```json
[
  {"start": 0.0, "end": 1.8, "speaker": "SPEAKER_00"},
  {"start": 2.0, "end": 4.5, "speaker": "SPEAKER_01"},
  {"start": 5.0, "end": 7.0, "speaker": "SPEAKER_00"}
]
```

### 3Ô∏è‚É£ –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–æ–µ–¥–∏–Ω—è–µ—Ç —Ç–µ–∫—Å—Ç —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–ø–∏–∫–µ—Ä–∞—Ö

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –ë–µ—Ä–µ—Ç —Å–µ–≥–º–µ–Ω—Ç —Ç–µ–∫—Å—Ç–∞: "–ü—Ä–∏–≤–µ—Ç" (0.0-0.5 —Å–µ–∫)
2. –°–º–æ—Ç—Ä–∏—Ç –∫—Ç–æ –≥–æ–≤–æ—Ä–∏–ª –≤ —ç—Ç–æ –≤—Ä–µ–º—è: SPEAKER_00
3. –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç: `SPEAKER_00: "–ü—Ä–∏–≤–µ—Ç"`
4. –ü–æ–≤—Ç–æ—Ä—è–µ—Ç –¥–ª—è –≤—Å–µ—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤
5. –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—Ä–∞–∑—ã –æ–¥–Ω–æ–≥–æ —Å–ø–∏–∫–µ—Ä–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
[
  {
    "speaker": "SPEAKER_00",
    "text": "–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?",
    "start": 0.0,
    "end": 1.8
  },
  {
    "speaker": "SPEAKER_01",
    "text": "–û—Ç–ª–∏—á–Ω–æ, —Å–ø–∞—Å–∏–±–æ!",
    "start": 2.0,
    "end": 4.5
  }
]
```

---

## üíæ –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –º–æ–¥–µ–ª–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–µ—à–∞

```
Docker Volume: models_cache
‚îÇ
‚îî‚îÄ‚îÄ /root/.cache/
    ‚îú‚îÄ‚îÄ whisper/
    ‚îÇ   ‚îî‚îÄ‚îÄ medium.pt (1.5 GB) ‚Üê Whisper –º–æ–¥–µ–ª—å
    ‚îÇ
    ‚îú‚îÄ‚îÄ torch/
    ‚îÇ   ‚îî‚îÄ‚îÄ hub/ (300 MB) ‚Üê Pyannote –º–æ–¥–µ–ª—å
    ‚îÇ
    ‚îî‚îÄ‚îÄ huggingface/
        ‚îî‚îÄ‚îÄ token (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HF_TOKEN)
```

### –ì–¥–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏?

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è volume
docker volume inspect sonar_models_cache

# –†–∞–∑–º–µ—Ä –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
docker system df -v
```

---

## ‚è±Ô∏è –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ)
```
üåê –°–∫–∞—á–∏–≤–∞–Ω–∏–µ Whisper: ~5-10 –º–∏–Ω—É—Ç (1.5 GB)
üåê –°–∫–∞—á–∏–≤–∞–Ω–∏–µ Pyannote: ~2-5 –º–∏–Ω—É—Ç (300 MB)
‚è±Ô∏è TOTAL: 10-15 –º–∏–Ω—É—Ç
```

### –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—É—Å–∫–∏ (–∏–∑ –∫–µ—à–∞)
```
‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ Whisper –∏–∑ –∫–µ—à–∞: ~20 —Å–µ–∫—É–Ω–¥
‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ Pyannote –∏–∑ –∫–µ—à–∞: ~10 —Å–µ–∫—É–Ω–¥
‚è±Ô∏è TOTAL: 30-60 —Å–µ–∫—É–Ω–¥
```

---

## üîÑ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ?

### ‚úÖ –° Volume (—Ç–µ–∫—É—â–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞)

```bash
docker compose down
docker compose build --no-cache worker
docker compose up -d
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ú–æ–¥–µ–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≤ `models_cache` volume
- ‚úÖ Worker –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∑–∞ 30-60 —Å–µ–∫—É–Ω–¥
- ‚úÖ –°–∫–∞—á–∏–≤–∞—Ç—å –∑–∞–Ω–æ–≤–æ –Ω–µ –Ω—É–∂–Ω–æ

### ‚ùå –ë–µ–∑ Volume (–µ—Å–ª–∏ —É–¥–∞–ª–∏—Ç—å volume)

```bash
docker compose down -v  # ‚ö†Ô∏è –£–¥–∞–ª—è–µ—Ç volumes!
docker compose up -d
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚ùå –ú–æ–¥–µ–ª–∏ —É–¥–∞–ª–µ–Ω—ã
- ‚ùå –ù—É–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ (~10-15 –º–∏–Ω—É—Ç)
- ‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç

---

## üìà –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏

### –í –ª–æ–≥–∞—Ö —Ç–µ–ø–µ—Ä—å –≤–∏–¥–Ω–æ:

```
======================================================================
üöÄ Initializing ML Processor...
======================================================================
üì± Device: CPU
üì¶ Whisper cache: ‚úÖ Found
üìÇ Cache location: /root/.cache/whisper

======================================================================
üé§ Loading Whisper model (medium)...
======================================================================
‚úÖ Whisper model loaded successfully

======================================================================
üë• Loading pyannote diarization model...
======================================================================
üîë HuggingFace token found, using latest model (3.1)
‚úÖ Diarization model loaded successfully

======================================================================
‚ú® ML Processor ready!
======================================================================
```

### –ï—Å–ª–∏ –º–æ–¥–µ–ª–∏ –Ω—É–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å:

```
üì¶ Whisper cache: ‚è¨ Will download (~1.5GB)
‚è¨ Downloading Whisper model... (this may take 5-10 minutes)
üí° Tip: Model will be cached for future use
```

---

## üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä

### –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```
üéôÔ∏è –ê—É–¥–∏–æ: meeting.wav (5 –º–∏–Ω—É—Ç, 2 —á–µ–ª–æ–≤–µ–∫–∞)
```

### –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏

**1. Whisper (2 –º–∏–Ω—É—Ç—ã –Ω–∞ CPU):**
```
–†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: 847 —Å–ª–æ–≤
–Ø–∑—ã–∫: —Ä—É—Å—Å–∫–∏–π
Confidence: 94.2%
```

**2. Pyannote (1.5 –º–∏–Ω—É—Ç—ã –Ω–∞ CPU):**
```
–ù–∞–π–¥–µ–Ω–æ —Å–ø–∏–∫–µ—Ä–æ–≤: 2
SPEAKER_00: 154 —Å–µ–≥–º–µ–Ω—Ç–∞ (60% –≤—Ä–µ–º–µ–Ω–∏)
SPEAKER_01: 89 —Å–µ–≥–º–µ–Ω—Ç–æ–≤ (40% –≤—Ä–µ–º–µ–Ω–∏)
```

**3. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ (< 1 —Å–µ–∫—É–Ω–¥—ã):**
```
–ò—Ç–æ–≥–æ–≤—ã—Ö —Ä–µ–ø–ª–∏–∫: 76
–°–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–æ –ø–æ —Å–ø–∏–∫–µ—Ä–∞–º: 38 + 38
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç

```json
{
  "session_id": "abc123",
  "duration": "5:00",
  "speakers": 2,
  "utterances": [
    {
      "speaker": "SPEAKER_00",
      "text": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –ö–∞–∫ –ø—Ä–æ—à–ª–∞ –≤—Å—Ç—Ä–µ—á–∞?",
      "start": 0.5,
      "end": 3.2,
      "confidence": 0.95
    },
    {
      "speaker": "SPEAKER_01",
      "text": "–û—Ç–ª–∏—á–Ω–æ! –ö–ª–∏–µ–Ω—Ç —Å–æ–≥–ª–∞—Å–∏–ª—Å—è –Ω–∞ –≤—Å–µ —É—Å–ª–æ–≤–∏—è.",
      "start": 3.8,
      "end": 7.1,
      "confidence": 0.92
    }
  ]
}
```

---

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ù–∞ CPU (—Ç–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- ‚è±Ô∏è 1 –º–∏–Ω—É—Ç–∞ –∞—É–¥–∏–æ = ~40-60 —Å–µ–∫—É–Ω–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- üé§ Whisper: ~30 —Å–µ–∫
- üë• Pyannote: ~20 —Å–µ–∫
- üîß –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ: <1 —Å–µ–∫

### –ù–∞ GPU (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å)
- ‚è±Ô∏è 1 –º–∏–Ω—É—Ç–∞ –∞—É–¥–∏–æ = ~5-10 —Å–µ–∫—É–Ω–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- üé§ Whisper: ~3 —Å–µ–∫
- üë• Pyannote: ~2 —Å–µ–∫
- üöÄ –£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 4-6 —Ä–∞–∑!

---

## üîß –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å

### –î–æ–±–∞–≤–∏—Ç—å HuggingFace —Ç–æ–∫–µ–Ω (–¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞)

1. –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω: https://huggingface.co/settings/tokens
2. –î–æ–±–∞–≤–∏—Ç—å –≤ `.env`:
```bash
HF_TOKEN=hf_xxxxxxxxxxxxxxxxxx
```
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å worker:
```bash
docker compose restart worker
```

### –í–∫–ª—é—á–∏—Ç—å GPU (–µ—Å–ª–∏ –µ—Å—Ç—å NVIDIA)

–í `docker-compose.yml` —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å:
```yaml
worker:
  deploy:
    resources:
      reservations:
        devices:
          - driver: nvidia
            count: all
            capabilities: [gpu]
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–æ–¥–µ–ª–µ–π
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –∑–∞–≥—Ä—É–∑–∫–∏
docker compose logs worker | grep "ML Processor"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –∫–µ—à–∞
docker exec sonar_worker du -sh /root/.cache/whisper
docker exec sonar_worker du -sh /root/.cache/torch
```

### –£–¥–∞–ª–∏—Ç—å –∫–µ—à (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
```bash
# –£–¥–∞–ª–∏—Ç—å –º–æ–¥–µ–ª–∏ –∏ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –º–µ—Å—Ç–æ
docker compose down
docker volume rm sonar_models_cache
docker compose up -d

# –ú–æ–¥–µ–ª–∏ —Å–∫–∞—á–∞—é—Ç—Å—è –∑–∞–Ω–æ–≤–æ (~10-15 –º–∏–Ω—É—Ç)
```

---

## ‚ùì FAQ

**Q: –ü–æ—á–µ–º—É –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –¥–æ–ª–≥–∏–π?**
A: –ú–æ–¥–µ–ª–∏ –≤–µ—Å—è—Ç 1.8 GB –∏ —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞.

**Q: –ú–æ–¥–µ–ª–∏ —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑?**
A: –ù–µ—Ç! –û–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Docker volume `models_cache`.

**Q: –ß—Ç–æ –µ—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –º–µ—Å—Ç–∞?**
A: –ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 3 GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –¥–ª—è –º–æ–¥–µ–ª–µ–π.

**Q: –ú–æ–∂–Ω–æ —É—Å–∫–æ—Ä–∏—Ç—å?**
A: –î–∞! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ GPU (—É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 4-6 —Ä–∞–∑).

**Q: –ü–æ—á–µ–º—É SPEAKER_00, –∞ –Ω–µ "–ò–≤–∞–Ω"?**
A: –ú–æ–¥–µ–ª—å –Ω–µ –∑–Ω–∞–µ—Ç –∏–º–µ–Ω–∞, –æ–Ω–∞ —Ç–æ–ª—å–∫–æ –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø–æ—Ö–æ–∂–∏–µ –≥–æ–ª–æ—Å–∞.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –∏–º–µ–Ω–∞ —Å–ø–∏–∫–µ—Ä–æ–≤?**
A: –î–∞, –Ω–æ —ç—Ç–æ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏.
